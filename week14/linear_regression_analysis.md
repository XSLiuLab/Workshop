## çº¿æ€§å›å½’

#### ç®€å•çº¿æ€§å›å½’

ç®€å•çº¿æ€§å›å½’å‡è®¾ä¸¤ä¸ªè¿ç»­å˜é‡ä¹‹é—´æ˜¯çº¿æ€§å…³ç³»çš„:
$$
Y_i=\beta_0+\beta_1X_i+ğœ–_i
$$
$Y_i$è¡¨ç¤ºç¬¬iä¸ªå› å˜é‡(reponse),$X_i$è¡¨ç¤ºç¬¬iä¸ªè‡ªå˜é‡(feature),$\beta_0,\beta_1$ æ˜¯éœ€è¦æ¨¡å‹çš„å‚æ•°,$ğœ–_i$æ˜¯å™ªéŸ³æˆ–è€…è¯´éšæœºè¯¯å·®(random error),åœ¨çº¿æ€§å›å½’é‡Œé¢å‡è®¾$ğœ–_i$æ˜¯æœä»æ­£æ€åˆ†å¸ƒ: $ğœ–$ ~ $norm(0,\sigma^2)$

æ‰€ä»¥$E(ğœ–)=0$ ,ä¸Šé¢çš„å¼å­å¯ä»¥å†™æˆï¼š
$$
E(Y_i|X_i)=E(\beta_0+\beta_1X_i+ğœ–_i|X_i)=\beta_0+\beta_1X_i
$$
çº¿æ€§å›å½’å°±æ˜¯ä¼°è®¡è¿™ä¸ªæ¡ä»¶æœŸæœ›ï¼š
$$
\hat{Y_i}=\hat{\beta_0}+\hat{\beta_1}X_i
$$
ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼°è®¡å‡ºæ¥çš„ç³»æ•°è§£é‡Šçš„æ˜¯å¹³å‡çš„æ•ˆåº”ï¼šæˆªè·ğ›½0è¡¨ç¤ºğ‘‹= 0æ—¶çš„å¹³å‡å“åº”å€¼,æ–œç‡ğ›½1è¡¨ç¤ºæ¯å¢åŠ 1ä¸ªå•ä½ï¼Œå¹³å‡å“åº”çš„å¢åŠ (å³å˜åŒ–ç‡)

åŸºäºæ•°æ®ä¼°è®¡çš„å€¼æ˜¯$\beta_0+\beta_1X_i$ è€ŒçœŸå®çš„å€¼æ˜¯$Y_i$ å¦‚ä½•è¡¡é‡ä¼°è®¡å€¼å’ŒçœŸå®å€¼çš„æ¥è¿‘ç¨‹åº¦ï¼Ÿæœ‰å¾ˆå¤šæ–¹æ³•å»è¡¡é‡è¿™ä¸ªæ¥è¿‘åº¦(closeness),ä½†æœ€å¸¸ç”¨çš„æ˜¯æœ€å°äºŒä¹˜æ³•

å®šä¹‰æ®‹å·®(residual,e)ä¸ºçœŸå®å€¼å’Œé¢„æµ‹å€¼çš„å·®,æ®‹å·®å¹³æ–¹å’Œ( residual sum of squares ,RSS)ä¸ºæ‰€æœ‰æ®‹å·®çš„å¹³æ–¹å’Œï¼š
$$
RSS=(Y_1âˆ’\hat{Î²_0}âˆ’\hat{Î²_1}X_1)^2 +(Y_2âˆ’\hat{Î²_0}âˆ’\hat{Î²_1}X_2) +...+(Y_nâˆ’\hat{Î²_0}âˆ’\hat{Î²_1}X_n)
$$
æœ€å°äºŒä¹˜æ³•å°±æ˜¯æ±‚å‡ºä½¿å¾—RSSæœ€å°çš„$\hat{\beta_0},\hat{\beta_1}$ :
$$
\hat{\beta_1}=\frac{\sum_{i=1}^n(X_i-\bar X)(Y_i-\bar Y)}{\sum_{i=1}^n(X_i-\bar X)} \\
\hat{\beta_0}=\bar{Y}-\hat{\beta_1}\bar X
$$

ä½¿ç”¨`MASS`åŒ…ä¸­çš„`Boston`æ•°æ®é›†ä½œä¸ºç¤ºä¾‹ï¼š

```R
##linear regression
library(MASS)
library(ISLR)

## data
names(Boston)
# [1] "crim"    "zn"      "indus"   "chas"    "nox"    
# [6] "rm"      "age"     "dis"     "rad"     "tax"    
# [11] "ptratio" "black"   "lstat"   "medv"

##æ‹Ÿåˆä¸€ä¸ªç®€å•çº¿æ€§å›å½’æ¨¡å‹ï¼Œè‡ªå˜é‡æ˜¯lstatï¼Œå› å˜é‡æ˜¯medv
lm_fit <- lm(medv~lstat,data = Boston)
summary(lm_fit)
```

![image-20200818183623822](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200818183623822.png)

å¯ä»¥ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„å‡½æ•°æ¥å¾—åˆ°è¿™äº›ä¿¡æ¯ï¼Œæ¯”å¦‚`coef()`å¾—åˆ°ç³»æ•°

```R
coef(lm_fit)
# (Intercept)       lstat 
# 34.5538409    -0.9500494 
```

#### å¤šå…ƒçº¿æ€§å›å½’

å½“è‡ªå˜é‡æœ‰å¤šä¸ªçš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨å¤šå…ƒçº¿æ€§å›å½’æ¥æ‹Ÿåˆæ•°æ®ï¼š
$$
Y = Î²_0 +Î²_1X_1 +Î²_2X_2 +Â·Â·Â·+Î²_pX_p+Îµ
$$
ç³»æ•°çš„ä¼°è®¡ä½¿ç”¨æœ€å°äºŒä¹˜æ³•å’Œç®€å•çº¿æ€§å›å½’ç±»ä¼¼ï¼Œæœ€å°åŒ–RSSï¼š
$$
RSS=\sum_{i=1}^n(y_i-\hat{y_i})^2=\sum_{i=1}^n(y_i-\hat{\beta_0}-\hat{\beta_1x_{i1}}-\hat{\beta_2x_{i2}}- Â·Â·Â·-\hat{\beta_p}x_{ip})^2
$$
å¯ä»¥ä½¿ç”¨`+`æ¥åŠ å…¥å…¶å®ƒçš„å˜é‡:

```R
lm_fit2 <- lm(medv~lstat+age,data = Boston)
summary(lm_fit2)
```

![image-20200818192636156](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200818192636156.png)

å¦‚æœè¦åŠ å…¥æ‰€æœ‰çš„å˜é‡çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨`.`æ¥ç®€åŒ–æ“ä½œï¼š

```R
lm_fit_all <- lm(medv~.,data = Boston)
summary(lm_fit_all)
```

![image-20200818192935973](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200818192935973.png)

å½“æˆ‘ä»¬éœ€è¦å‘ä¹‹å‰çš„æ¨¡å‹ä¸­æ·»åŠ å˜é‡æ—¶å¯ä»¥ä½¿ç”¨`updata`å‡½æ•°ï¼š

```R
lm_fit3 <- update(lm_fit2,~.+chas)
summary(lm_fit3)
```

#### ç³»æ•°ä¼°è®¡çš„å‡†ç¡®åº¦è¡¡é‡

$Y_i=\beta_0+\beta_1X_i+ğœ–_i$æä¾›çš„æ˜¯å¯¹X,Yçš„çœŸå®å…³ç³»çš„æœ€å¥½çº¿æ€§åº¦é‡ï¼Œé€šå¸¸ç§°ä¸ºæ€»ä½“å›å½’çº¿(population regression line),è€Œæˆ‘ä»¬åŸºäºæœ€å°äºŒä¹˜å›å½’ä¼°è®¡çš„$\hat{Y_i}=\hat{\beta_0}+\hat{\beta_1}X_i$ç›¸å½“äºå¯¹æ ·æœ¬æ•°æ®çš„çº¿æ€§åº¦é‡ï¼Œé€šå¸¸ç§°ä¸ºæœ€å°äºŒä¹˜çº¿(least squares line),ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æƒ³è¦ç”¨è¿™ä¸ªåŸºäºæ ·æœ¬è®¡ç®—çš„å€¼å»ä¼°è®¡æ€»ä½“çš„å‚æ•°

æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬å¯ä»¥ç”¨æ ·æœ¬çš„å‡å€¼å»ä¼°è®¡æ€»ä½“çš„å‡å€¼,å¹¶ä¸”æ ·æœ¬å‡å€¼æ˜¯æ€»ä½“å‡å€¼çš„æ— åä¼°è®¡é‡ï¼ˆæ— åä¼°è®¡é‡çš„æœŸæœ›ç­‰äºè¦ä¼°è®¡çš„å‚æ•°ï¼‰,å¯¹äºä¸€æ¬¡æŠ½æ ·ï¼Œè¯„ä¼°åˆ©ç”¨æŠ½æ ·æ ·æœ¬å‡å€¼å»ä¼°è®¡æ€»ä½“å‡å€¼çš„è¯¯å·®å¯ä»¥ä½¿ç”¨æ ‡å‡†è¯¯ï¼š
$$
Var(\hat{\mu})=SE(\hat{\mu})^2=\frac{\sigma^2}{n}
$$
å¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹æ³•å»è¯„ä¼°ä¼°è®¡çš„$\hat{\beta_0},\hat{\beta_1}$ å’ŒçœŸå®å€¼çš„å·®å¼‚ï¼š
$$
SE(\hat{\beta_0})^2=\sigma^2[\frac{1}{n}+\frac{\bar{X}^2}{\sum_{i=1}^n(X_i-\bar X)^2}],SE(\hat{\beta_1})^2=\frac{\sigma^2}{\sum_{i=1}^n(X_i-\bar X)^2}
$$
è¿™é‡Œçš„$\sigma$æ˜¯å‰é¢æåˆ°çš„è¯¯å·®é¡¹çš„æ–¹å·®ï¼Œä¹Ÿå«æ®‹å·®æ ‡å‡†è¯¯(RSE),ä¹Ÿæ˜¯éœ€è¦ä¼°è®¡çš„,ä¼°è®¡çš„æ–¹æ³•æ˜¯æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼š
$$
\hat{\sigma}^2=\frac{1}{n-p-1}\sum_{i=1}^n(Y_i-\hat{Y_i})=\frac{RSS}{n-p-1},pæ˜¯å‚æ•°çš„æ•°é‡
$$
å¯ä»¥é€šè¿‡`sigma()`å‡½æ•°æ¥è·å¾—$\sigma$å€¼(ä¹Ÿå¯ä»¥ç›´æ¥çœ‹summaryé‡Œé¢çš„Residual standard error)ï¼š

```R
sigma(lm_fit)
#[1] 6.21576
```

æœ‰äº†æ ‡å‡†è¯¯å°±å¯ä»¥è®¡ç®—ç½®ä¿¡åŒºé—´å’Œè¿›è¡Œå‡è®¾æ£€éªŒäº†

åŸå‡è®¾ï¼šX,Yä¹‹é—´æ²¡æœ‰å…³ç³»,$\beta_1=0$

å¤‡æ‹©å‡è®¾ï¼šX,Yä¹‹é—´æœ‰å…³ç³»,$\beta_1\neq0$

æ£€éªŒç»Ÿè®¡é‡å¯ä»¥ä½¿ç”¨tç»Ÿè®¡é‡(è‡ªç”±åº¦ä¸ºn-p-1),è¿›è¡Œtæ£€éªŒ,å¾—åˆ°på€¼
$$
t=\frac{\hat{\beta_1}-0}{SE(\hat{\beta_1})}
$$

å‚æ•°çš„tç»Ÿè®¡é‡çš„å€¼(t value)å’Œç›¸åº”çš„på€¼(`Pr(>|t|)`)åœ¨æ¨¡å‹çš„`summary`é‡Œé¢éƒ½å¯ä»¥å¾—åˆ°

ä¹Ÿå¯ä»¥é€šè¿‡`confint`è·å¾—ç½®ä¿¡åŒºé—´ï¼š

```R
confint(lm_fit)
#                2.5 %     97.5 %
# (Intercept) 33.448457 35.6592247
# lstat       -1.026148 -0.8739505
```

#### å®šæ€§å˜é‡çš„å¤„ç†

å¯¹äºä¸€ä¸ªæœ‰ä¸¤ä¸ªlevelsçš„å› å­æ¥è¯´ï¼Œåˆ©ç”¨å…¶æ„å»ºå›å½’æ¨¡å‹éœ€è¦åˆ›å»ºä¸€ä¸ªindicatorï¼ˆdummy variableï¼‰

ä»¥`Credit`æ•°æ®ä¸ºä¾‹ï¼šå› å˜é‡æ˜¯Balanceï¼Œè¡¨ç¤ºä¿¡ç”¨å¡è´Ÿå€ºé¢åº¦

```R
data <- read.csv("~/Downloads/Credit.csv")
colnames(data)
# [1] "Income"    "Limit"     "Rating"    "Cards"     "Age"       "Education"
# [7] "Gender"    "Student"   "Married"   "Ethnicity" "Balance" 
```

æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦çœ‹æ€§åˆ«é—´çš„ä¿¡ç”¨å¡è´Ÿå€ºçš„å·®åˆ«ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªdummy å˜é‡ï¼š
$$
x_i=\left\{
\begin{aligned}
1\ ç”·æ€§\\
0\ å¥³æ€§
\end{aligned}
\right.
$$
ç„¶åç”¨è¿™ä¸ªå˜é‡å»æ„å»ºå›å½’æ¨¡å‹ï¼š
$$
y_i=\beta_0+\beta_1x_i+Îµ_i=\left\{
\begin{aligned}
\beta_0+\beta_1+Îµ_i\ if\ ith\ person\ is\ male\\
\beta_0+Îµ_i\ if\ ith\ person\ is\ female
\end{aligned}
\right.
$$
æ‰€ä»¥$\beta_0$å°±å¯ä»¥è§£é‡Šä¸ºå¥³æ€§çš„å¹³å‡ä¿¡ç”¨å¡è´Ÿå€ºï¼Œ$\beta_0+\beta_1$ä¸ºç”·æ€§çš„å¹³å‡ä¿¡ç”¨å¡è´Ÿå€ºï¼Œ$\beta_1$å°±æ˜¯ä¸¤è€…çš„å·®

```R
data$Gender <- factor(data$Gender,levels = c("Female","Male"),labels = c(1,0))
lm_fit4 <- lm(Balance~Gender,data = data)
```

![image-20200818225449907](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200818225449907.png)

å¯ä»¥çœ‹åˆ°å¥³æ€§çš„balanceæ˜¯529.54,è€Œç”·æ€§çš„æ˜¯529.54+(-19.73)=509.80,å·®å€¼æ˜¯19.73ä½†æ˜¯på€¼æ¯”è¾ƒå¤§ï¼Œè¯´æ˜æ²¡æœ‰è¶³å¤Ÿçš„ç»Ÿè®¡å­¦è¯æ®è¡¨æ˜æ€§åˆ«ä¹‹é—´çš„å¹³å‡ä¿¡ç”¨å¡è´Ÿå€ºæ˜¯æœ‰å·®è·çš„

å¦‚æœå®šæ€§çš„é¢„æµ‹å˜é‡çš„æ°´å¹³å¤§äºä¸¤ä¸ªï¼Œæˆ‘ä»¬å°±ä¸èƒ½ç”¨ä¸€ä¸ªdummyå˜é‡åŒ…æ‹¬è¿™äº›æ°´å¹³ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ›å»ºé¢å¤–çš„dummyå˜é‡

æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦é¢„æµ‹ä¿¡ç”¨å¡çš„balanceå’Œç§æ—ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥åˆ›å»ºå¦‚ä¸‹çš„å˜é‡ï¼š
$$
x_{i1}=\left\{
\begin{aligned}
1\ if \ ith\ person\ is\ Asian\\
0\ if \ ith\ person\ is\ not\ Asian
\end{aligned}
\right.
$$

$$
x_{i1}=\left\{
\begin{aligned}
1\ if \ ith\ person\ is\ Caucasian\\
0\ if \ ith\ person\ is\ not\ Caucasian
\end{aligned}
\right.
$$

æ¨¡å‹å¯ä»¥è¡¨ç¤ºä¸ºï¼š
$$
yi = Î²_0+Î²_1x_{i1}+Î²_2x_{i2}+Îµ_i=\left\{
\begin{aligned}
Î²_0+Î²_1+Îµ_i\ if \ ith\ person\ is\ Asian\\
Î²_0+Î²_2+Îµ_i\ if \ ith\ person\ is\ \ Caucasian\\
Î²_0+Îµ_i\ if\ ith\ person\ is\ African\ American.
\end{aligned}
\right.
$$

```R
data$Ethnicity <- factor(data$Ethnicity,
                         levels = c("African American","Asian","Caucasian"))
lm_fit5 <- lm(Balance~Ethnicity,data = data)
summary(lm_fit5)
```

![image-20200818230453090](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200818230453090.png)

#### æ¨¡å‹çš„å‡†ç¡®åº¦è¡¡é‡

ä¸€æ—¦æˆ‘ä»¬å¯ä»¥æ‹’ç»ä¸Šé¢çš„åŸå‡è®¾ï¼Œè®¤ä¸ºX,Yé—´æœ‰æŸç§å…³ç³»ï¼Œä¸‹ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼šæ€ä¹ˆè¡¡é‡æ‹Ÿåˆçš„æ¨¡å‹åæ˜ è¿™ç§å…³ç³»çš„ç¨‹åº¦

åœ¨çº¿æ€§å›å½’æ‹Ÿåˆä¸­ä¸€èˆ¬ä½¿ç”¨æ®‹å·®æ ‡å‡†è¯¯(RSE)å’ŒR^2^ æ¥è¡¡é‡
$$
RSE=\sqrt{\frac{1}{n-p-1}\sum_{i=1}^n(y_i-\hat{y_i})^2},pæ˜¯å‚æ•°çš„æ•°é‡
$$
å¯ä»¥è¿™æ ·æ¥ç†è§£RSEï¼šå³ä½¿çœŸå®çš„Î²0ï¼ŒÎ²1å·²ç»çŸ¥é“äº†ï¼Œæ ¹æ®Xæ¥é¢„æµ‹Yï¼Œå¹³å‡è¿˜ä¼šäº§ç”ŸRSEä¸ªå•ä½çš„åç¦»

å¦‚æœé¢„æµ‹çš„å€¼å’Œå®é™…çš„å€¼å·®ä¸å¤š,RSEå°±æ¯”è¾ƒå°;å¦‚æœé¢„æµ‹çš„è¿œç¦»å®é™…çš„å€¼,RSEå°±ä¼šæ¯”è¾ƒå¤§

ä½†æ˜¯ç”±äºRSEæ˜¯ä¸€ä¸ªç»å¯¹å€¼,æˆ‘ä»¬ä¸çŸ¥é“å¤šå°çš„RSEè¡¨ç¤ºæ¨¡å‹æ‹Ÿåˆçš„æ¯”è¾ƒå¥½,åœ¨ä¸åŒçš„æ¨¡å‹é—´ä¹Ÿä¸å¥½æ¯”è¾ƒ,æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹RSEè¿›è¡Œâ€æ ‡å‡†åŒ–â€œ

å¦‚æœæ²¡æœ‰æ¨¡å‹ï¼Œæœ€æœ´ç´ çš„é¢„æµ‹å°±æ˜¯ç”¨å‡å€¼ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å‡å€¼æ¥ä»£æ›¿$\hat{y_i}$æ¥è¿›è¡Œæ ‡å‡†åŒ– :
$$
NRSE=\frac{\sqrt{\frac{1}{n-p}\sum_{i=1}^n(y_i-\hat{y_i})^2}}{\sqrt{\frac{1}{n-p}\sum_{i=1}^n(y_i-\bar y_i})^2}=\frac{\sum_{i=1}^n(y_i-\hat{y_i})^2}{\sum_{i=1}^n(y_i-\bar y_i)^2}
$$

$$
R^2=1-NRSE=1-\frac{\sum_{i=1}^n(y_i-\hat{y_i})^2}{\sum_{i=1}^n(y_i-\bar y_i)^2}
$$

å½“$R^2$å°äº0ï¼Œè¯´æ˜ç”¨æ¨¡å‹è¿˜ä¸å¦‚æ²¡æœ‰æ¨¡å‹(ç›´æ¥ç”¨å¹³å‡å€¼é¢„æµ‹)

å¯ä»¥å¯¹$R^2$å˜æ¢ä¸€ä¸ªå½¢å¼ï¼š
$$
R^2=\frac{\sum_{i=1}^n(y_i-\bar{y_i})^2-\sum_{i=1}^n(y_i-\hat{y_i})^2}{\sum_{i=1}^n(y_i-\bar y_i)^2}=\frac{TSS-RSS}{TSS}
$$

TSS(total sum of squres)è¡¡é‡çš„æ˜¯Yçš„æ€»çš„å˜åŒ–ï¼ŒRSSè¡¨ç¤ºæ‹Ÿåˆæ¨¡å‹åYçš„å˜åŒ–ä»ç„¶ä¸èƒ½è¢«Xçš„å˜åŒ–è§£é‡Šçš„éƒ¨åˆ†

å› æ­¤R^2^ è¡¨ç¤ºçš„æ˜¯é€šè¿‡å»ºç«‹æ¨¡å‹ï¼ŒYçš„å˜åŒ–å¯ä»¥è¢«Xè§£é‡Šçš„æ¯”ä¾‹

ä¸Šé¢çš„ä¾‹å­å°±è¯´æ˜ä½æˆ¿ä»·æ ¼çš„å˜åŒ–çš„74%å¯ä»¥è¢«è¿™13ä¸ªå˜é‡è§£é‡Š

å½“åŠ å…¥å˜é‡æ—¶RSSæ˜¯å•è°ƒé€’å‡,R^2^æ˜¯å•è°ƒé€’å¢,å¦‚æœä½¿ç”¨è¿™äº›æ ‡å‡†é€‰æ‹©çš„æœ€ä¼˜æ¨¡å‹è‚¯å®šæ˜¯å«æœ‰è¾ƒå¤šå˜é‡çš„;å¹¶ä¸”è¿™è¿™äº›æ–¹æ³•è¡¡é‡çš„æ˜¯è®­ç»ƒé›†çš„è¯¯å·®ï¼Œè€Œæˆ‘ä»¬æ›´å¸Œæœ›å¾—åˆ°çš„æ˜¯æœ‰ç€æ›´ä½çš„æµ‹è¯•é›†è¯¯å·®çš„æ¨¡å‹ï¼Œæ‰€ä»¥åœ¨æ¯”è¾ƒå¤šä¸ªæœ‰ç€ä¸åŒè‡ªå˜é‡æ•°ç›®çš„æ¨¡å‹çš„æ—¶å€™è¿™äº›æ–¹æ³•å°±ä¸é€‚ç”¨äº†

å…¶ä»–çš„æ–¹æ³•ï¼šAIC(Akaike information criterion) ;BIC(Bayesian information criterion) ;çŸ«æ­£çš„R^2^, $C_p$ 
$$
C_p=\frac{1}{n}(RSS+2d\hat{\sigma}^2)
$$
dè¡¨ç¤ºå˜é‡çš„æ•°é‡ï¼Œç›¸å½“äºåœ¨RSSä¸ŠåŠ äº†ä¸€ä¸ªç½šåˆ†é¡¹($2d\hat{\sigma}^2$),å¯ä»¥è¯æ˜$C_P$æ˜¯æµ‹è¯•è¯¯å·®çš„æ— åä¼°è®¡ï¼Œæ‰€ä»¥æœ€ä½³çš„æ¨¡å‹$C_p$æ˜¯æœ€ä½çš„
$$
AIC=\frac{1}{n\hat{\sigma}^2}(RSS+2d\hat{\sigma}^2)
$$
AICå’Œ$C_p$æ˜¯æˆæ¯”ä¾‹çš„
$$
BIC=\frac{1}{n\hat{\sigma}^2}(RSS+log(n)d\hat{\sigma}^2)
$$
å› ä¸ºå½“nå¤§äº7çš„æ—¶å€™log(n)æ˜¯å¤§äº2çš„ï¼Œæ‰€ä»¥BICå¯¹æ›´å¤šçš„å˜é‡ç»™äºˆç›¸å¯¹äº$C_p$è¾ƒå¤šçš„ç½šåˆ†ï¼Œç»“æœå°±æ˜¯ç›¸å¯¹äº$C_p$ä¼šé€‰æ‹©æ›´å°çš„æ¨¡å‹
$$
adjusted\ R^2=1-\frac{RSS/(n-d-1)}{TSS/(n-1)}
$$
å½“å˜é‡å¢å¤šçš„æ—¶å€™RSSä¼šä¸‹é™ï¼Œä½†æ˜¯$\frac{RSS}{n-d-1}$ ä¸‹é™è¿˜æ˜¯ä¸Šå‡ä¸RSSå’Œdç›¸å…³ï¼Œå½“RSSä¸‹é™æ¯”è¾ƒå¤šçš„æ—¶å€™adjusted R^2^å°±ä¼šä¸Šå‡ï¼Œæ‰€ä»¥æœ€ä½³çš„æ¨¡å‹æ˜¯çŸ«æ­£çš„R^2^æœ€å¤§çš„æ¨¡å‹

è¿™å‡ ç§æ–¹æ³•éƒ½æ˜¯å¯¹æµ‹è¯•é›†è¯¯å·®çš„ä¼°è®¡,å¹¶ä¸”åŸºäºä¸€äº›å‡è®¾(è¯¯å·®é¡¹æœä»æ­£æ€åˆ†å¸ƒç­‰)ï¼Œå¦å¤–ä¸€ä¸ªé€‰æ‹©å°±æ˜¯ä½¿ç”¨äº¤å‰éªŒè¯çš„æ–¹æ³•ç›´æ¥æ¥è®¡ç®—æµ‹è¯•è¯¯å·®(å°†æ•°æ®åˆ†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œåœ¨è®­ç»ƒé›†é‡Œé¢æ‹Ÿåˆæ¨¡å‹ï¼Œé€‰æ‹©æ¨¡å‹ï¼›åœ¨æµ‹è¯•é›†é‡Œé¢ä¼°è®¡æµ‹è¯•è¯¯å·®)

#### å¤šè‡ªå˜é‡ç³»æ•°å¤åˆå‡è®¾æ£€éªŒ

å‰é¢æ˜¯å¯¹å•ä¸ªç³»æ•°çš„æ£€éªŒï¼Œä½†æ˜¯æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªæ¨¡å‹æœ€å¼€å§‹çš„é—®é¢˜å°±æ˜¯é€‰æ‹©çš„å˜é‡ä¸­æ˜¯ä¸æ˜¯è‡³å°‘æœ‰ä¸€ä¸ªå˜é‡å’ŒYæ˜¯ç›¸å…³çš„

æ‰€ä»¥ç°åœ¨çš„åŸå‡è®¾ä¸ºï¼šæ‰€æœ‰çš„å˜é‡éƒ½ä¸Yæ— å…³ï¼Œ$\beta_1=\beta_2=...=\beta_p=0$; å¤‡æ‹©å‡è®¾ä¸ºï¼šè‡³å°‘æœ‰ä¸€ä¸ªå˜é‡ä¸Yç›¸å…³ï¼Œä¹Ÿå°±æ˜¯è‡³å°‘æœ‰ä¸€ä¸ª$\beta_j$ä¸ä¸º0

æ£€éªŒçš„ç»Ÿè®¡é‡ä¸ºFç»Ÿè®¡é‡ï¼š
$$
F=\frac{(TSS-RSS)/p}{RSS/(n-p-1)},pæ˜¯å˜é‡çš„æ•°ç›®
$$
è‡ªç”±åº¦æ˜¯p,n-p-1

æ³¨æ„ï¼šå½“å®šæ€§å˜é‡æœ‰å¤šä¸ªæ°´å¹³çš„æ—¶å€™ï¼Œå•ç‹¬çœ‹æ¯ä¸ªæ°´å¹³çš„tæ£€éªŒæ˜¾è‘—æ€§ä¸èƒ½è¯´æ˜å˜é‡çš„æ˜¾è‘—æ€§ï¼Œå› ä¸ºå®šæ€§å˜é‡çš„æ˜¾è‘—æ€§æ„å‘³ç€å„ä¸ªæ°´å¹³å¯¹å› å˜é‡å½±å“çš„å·®å¼‚

ä»¥Rä¸­çš„æ•°æ®é›†`PlantGrowth`ä¸ºä¾‹ï¼Œå› å˜é‡æ˜¯`weight`(æ¤ç‰©çš„å¹²é‡)ï¼Œè‡ªå˜é‡æ˜¯`group`æœ‰3ä¸ªæ°´å¹³ï¼Œä¸¤ä¸ªå®éªŒç»„(trt1,trt2)ä¸€ä¸ªå¯¹ç…§ç»„(ctrl1)

```R
a <- lm(weight~group,data = PlantGrowth)
summary(a)
##æˆ–è€…ç”¨anovaæ–¹å·®åˆ†æ
anova(a)
```

![image-20200818234741372](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200818234741372.png)

![image-20200819084925880](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200819084925880.png)

#### å˜é‡é€‰æ‹©

å†³å®šå“ªäº›è‡ªå˜é‡ä¸å› å˜é‡ç›¸å…³ï¼Œä»è€Œæ„å»ºä¸€ä¸ªåŒ…å«è¿™äº›å˜é‡çš„æ¨¡å‹çš„è¿‡ç¨‹å«åšå˜é‡é€‰æ‹©(variable selection)ï¼Œæœ€ç›´è§‚çš„æ–¹æ³•å°±æ˜¯åˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„æ¨¡å‹çœ‹å“ªä¸ªæœ€å¥½

æœ€å¸¸ç”¨çš„3ç§ç»å…¸çš„æ–¹æ³•æœ‰ï¼š

- `best subset`

- `Forward selection` 
- `Backward selection`
- `Mixed selection`

##### Best subset

ç®—æ³•ï¼š

- $M_0$è¡¨ç¤ºç©ºæ¨¡å‹ï¼Œå³æ²¡æœ‰ä»»ä½•è‡ªå˜é‡
- å¯¹äºk=1,2,...p:
  - æ‹Ÿåˆå«æœ‰kä¸ªè‡ªå˜é‡çš„æ‰€æœ‰æ¨¡å‹ï¼Œ$\binom{p}{k}$ä¸ª
  - åœ¨$\binom{p}{k}$ä¸ªæ¨¡å‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„æ¨¡å‹$M_k$(æœ€å°çš„RSSæˆ–è€…æœ€å¤§çš„R^2^)
- åœ¨$M_0,M_1,M_2,...M_k$çš„p+1ä¸ªæ¨¡å‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„æ¨¡å‹,æ³¨æ„è¿™ä¸ªæ—¶å€™ä¸èƒ½ä½¿ç”¨RSSæˆ–è€…R^2^ ,å› ä¸ºå½“åŠ å…¥å˜é‡æ—¶RSSæ˜¯å•è°ƒé€’å‡,R^2^æ˜¯å•è°ƒé€’å¢, æ‰€ä»¥å¦‚æœä½¿ç”¨è¿™äº›æ ‡å‡†é€‰æ‹©çš„æœ€ä¼˜æ¨¡å‹è‚¯å®šæ˜¯å«æœ‰æ‰€æœ‰å˜é‡çš„ï¼Œå› æ­¤ä½¿ç”¨äº¤å‰éªŒè¯çš„æ–¹æ³•ï¼Œæˆ–è€…BIC AICæˆ–è€…çŸ«æ­£çš„R^2^ 

éœ€è¦è€ƒè™‘2^p^ä¸ªæ¨¡å‹ï¼Œè®¡ç®—é‡æ¯”è¾ƒå¤§

ä½¿ç”¨çš„æ•°æ®æ˜¯`ISLR`åŒ…é‡Œé¢çš„`Hitters`æ•°æ®ï¼Œæ ¹æ®ä¸€äº›å˜é‡(ä¸€å…±æœ‰19ä¸ªå˜é‡)æ¥é¢„æµ‹æ£’çƒè¿åŠ¨å‘˜çš„å·¥èµ„(Salary)ï¼š

```R
library(ISLR)
Hitters <- na.omit(Hitters)
names(Hitters) 
# [1] "AtBat"     "Hits"      "HmRun"     "Runs"      "RBI"      
# [6] "Walks"     "Years"     "CAtBat"    "CHits"     "CHmRun"   
# [11] "CRuns"     "CRBI"      "CWalks"    "League"    "Division" 
# [16] "PutOuts"   "Assists"   "Errors"    "Salary"    "NewLeague"
```

`leaps`åŒ…çš„`regsubsets`å‡½æ•°å¯ä»¥æ¥è¿›è¡Œbest subset selection:

```R
library(leaps)
fit_full <- regsubsets(Salary~.,data = Hitters)
summary(fit_full)
```

![image-20200819110700950](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200819110700950.png)

æ ‡æ˜Ÿå·çš„è¡¨ç¤ºåœ¨ç›¸åº”å˜é‡æ•°é‡çš„æ¨¡å‹ä¸­é€‰æ‹©çš„å˜é‡ï¼Œé»˜è®¤åªè¾“å‡ºæœ€å¥½çš„8ä¸ªï¼Œä½¿ç”¨`nvmax`å‚æ•°æŒ‡å®šè¾“å‡ºçš„æ¨¡å‹æ•°é‡

```R
fit_full <- regsubsets(Salary~.,data = Hitters,nvmax = 19)
summary(fit_full)
```

![image-20200819111006642](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200819111006642.png)

`summary`ä¹Ÿä¼šè¿”å›R^2^,AIC BIC çŸ«æ­£çš„R^2^, $C_p$ ï¼š

```R
summ <- summary(fit_full)
names(summ)
#[1] "which"  "rsq"    "rss"    "adjr2"  "cp"     "bic"    "outmat" "obj" 
summ$rsq
# [1] 0.3214501 0.4252237 0.4514294 0.4754067 0.4908036 0.5087146 0.5141227 0.5285569 0.5346124
# [10] 0.5404950 0.5426153 0.5436302 0.5444570 0.5452164 0.5454692 0.5457656 0.5459518 0.5460945
# [19] 0.5461159
```

```R
par(mfrow=c(2,2))
plot(summ$rss ,xlab="Number of Variables ",ylab="RSS",
     type="l")
plot(summ$adjr2 ,xlab="Number of Variables ",
     ylab="Adjusted RSq",type="l")
which.max(summ$adjr2)
points(11,summ$adjr2[11], col="red",cex=2,pch=20)
plot(summ$cp ,xlab="Number of Variables ",ylab="Cp", type='l')
which.min(summ$cp ) #[1] 10
points(10,summ$cp [10],col="red",cex=2,pch=20)
which.min(summ$bic )#[1] 6
plot(summ$bic ,xlab="Number of Variables ",ylab="BIC",
       type='l')
points(6,summ$bic [6],col="red",cex=2,pch=20)
```

![image-20200819111843433](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200819111843433.png)

é€‰æ‹©æ¨¡å‹ï¼š

```R
coef(fit_full ,6)
# (Intercept)     AtBat        Hits     Walks         CRBI        DivisionW      PutOuts 
# 91.5117981   -1.8685892   7.6043976    3.6976468    0.6430169 -122.9515338    0.2643076 
```

##### Forward selection

ç®—æ³•ï¼š

- $M_0$è¡¨ç¤ºç©ºæ¨¡å‹
- å¯¹äºk=0,...p-1
  - æ‹Ÿåˆæ‰€æœ‰åœ¨åŸæ¥æ¨¡å‹ä¸ŠåŠ ä¸Šä¸€ä¸ªå˜é‡çš„æ¨¡å‹ï¼Œp-kä¸ª
  - åœ¨p-kä¸ªæ¨¡å‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„æ¨¡å‹(æœ€å°çš„RSSæˆ–è€…æœ€å¤§çš„R^2^)
- åœ¨$M_0,...M_p$ä¸­ä½¿ç”¨äº¤å‰éªŒè¯æˆ–è€…AIC BICæˆ–çŸ«æ­£çš„R^2^é€‰æ‹©æœ€ä¼˜çš„æ¨¡å‹

éœ€è¦è€ƒè™‘$1+p(p+1)/2$ä¸ªæ¨¡å‹ï¼Œç¼ºç‚¹å°±æ˜¯æ¯ä¸ªæ¨¡å‹éƒ½å¿…é¡»åŒ…å«ä¸Šä¸€ä¸ªå˜é‡ï¼Œæ¯”å¦‚æœ‰3ä¸ªå˜é‡ï¼Œæœ€ä½³çš„æ¨¡å‹æ˜¯åŒ…å«$X_2å’ŒX_3$ ä½†æ˜¯è¿™ç§æ–¹æ³•å°±æ‰¾ä¸åˆ°è¿™ç§æ¨¡å‹

ä½¿ç”¨å‚æ•°`methods="forward"`æ¥è¿›è¡ŒForward selection

```R
fit_forward <- regsubsets(Salary~.,data = Hitters,method = "forward",nvmax=19)
summary(fit_forward)
```

![image-20200819135914434](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200819135914434.png)

å¯ä»¥çœ‹åˆ°æœ€å¥½çš„ä¸€å˜é‡æ¨¡å‹åŒ…å«`CRBI`åé¢çš„æ¨¡å‹éƒ½å¿…é¡»æœ‰`CRBI`è¿™ä¸ªå˜é‡

##### Backward selection

ç®—æ³•ï¼š

- $M_p$è¡¨ç¤ºå…¨æ¨¡å‹ï¼Œå«æœ‰å…¨éƒ¨çš„å˜é‡
- å¯¹äºk=p,p-1,...1
  - æ‹Ÿåˆæ‰€æœ‰åœ¨åŸæ¥æ¨¡å‹ä¸Šå‡å»ä¸€ä¸ªå˜é‡çš„æ¨¡å‹ï¼Œkä¸ª
  - åœ¨kä¸ªæ¨¡å‹ä¸­é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„æ¨¡å‹(æœ€å°çš„RSSæˆ–è€…æœ€å¤§çš„R^2^)
- åœ¨$M_0,...M_p$ä¸­ä½¿ç”¨äº¤å‰éªŒè¯ï¼Œæˆ–è€…AIC BICæˆ–çŸ«æ­£çš„R^2^é€‰æ‹©æœ€ä¼˜çš„æ¨¡å‹

éœ€è¦è€ƒè™‘$1+p(p+1)/2$ä¸ªæ¨¡å‹

ä½¿ç”¨`methods=backward`æ¥è¿›è¡ŒBackward selection

#### å…¶ä»–é—®é¢˜

##### äº’ä½œé¡¹

æœ‰äº›æ—¶å€™ä¸åŒçš„å˜é‡é—´ä¼šæœ‰ç›¸äº’ä½œç”¨ï¼Œä¾‹å¦‚ï¼šåŸºäºç”Ÿäº§çº¿å’Œå·¥äººçš„æ•°é‡æ¥é¢„æµ‹äº§å“çš„äº§é‡ï¼Œè¿™é‡Œé¢å·¥äººçš„æ•°é‡å’Œç”Ÿäº§çº¿çš„æ•°é‡æ˜¯æœ‰ç›¸äº’ä½œç”¨çš„ï¼Œå¦‚æœå·¥äººçš„æ•°é‡ä¸è¶³ï¼Œç”Ÿäº§çº¿å†å¤šä¹Ÿä¸èƒ½å¢åŠ äº§é‡

å¯ä»¥åœ¨æ¨¡å‹ä¸­åŠ å…¥äº’ä½œé¡¹(interaction term):
$$
Y=\beta_0+\beta_1X_1+...\beta_iX_iX_j+...+ğœ–
$$

```R
summary(lm(medv~lstat*age,data = Boston))
```

![image-20200819153428192](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200819153428192.png)

##### éçº¿æ€§å…³ç³»

å¯ä»¥ç”¨æ®‹å·®å›¾(æ®‹å·®å’Œé¢„æµ‹å€¼ç”»æ•£ç‚¹å›¾)æ¥è¯†åˆ«æ•°æ®çš„éçº¿æ€§å…³ç³»

```R
lm_fit <- lm(medv~lstat,data=Boston)
par(mfrow=c(1,2))
plot(lm_fit)
plot(predict(lm_fit),residuals(lm_fit))
lm_fit2=lm(medv~lstat+I(lstat^2),data = Boston)
plot(predict(lm_fit2),residuals(lm_fit2))
```

![image-20200819154737412](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200819154737412.png)

##### è¯¯å·®é¡¹çš„ä¸€äº›å‡è®¾

ä¹‹å‰å¯¹ä¼°è®¡çš„å›å½’ç³»æ•°ç®—å‡ºæ¥çš„æ ‡å‡†è¯¯æ˜¯å‡è®¾è¯¯å·®é¡¹Îµæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä¸ç›¸å…³çš„ï¼Œä½†æ˜¯å¦‚æœè¿™äº›è¯¯å·®é¡¹ä¸æ˜¯ç‹¬ç«‹çš„é‚£ä¹ˆæˆ‘ä»¬ç®—çš„æ–¹å·®å˜å°ï¼Œæ ‡å‡†è¯¯å˜å°ï¼Œç›¸åº”çš„ç³»æ•°çš„tç»Ÿè®¡é‡å°±ä¼šå˜å¤§ï¼Œæ‰€ä»¥ç½®ä¿¡åŒºé—´ä¼šå˜çª„ ï¼Œpå€¼å°±ä¼šæ¯”çœŸå®çš„è¦ä½ï¼Œå¯¼è‡´é”™è¯¯çš„ç»“è®º

æ¯”å¦‚æˆ‘ä»¬åŸºäºä½“é‡å»é¢„æµ‹èº«é«˜ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®é›†ä¸­æœ‰ä¸€äº›ä¸ªä½“æ¥è‡ªåŒä¸€ä¸ªå®¶åº­ï¼Œæˆ–è€…é¥®é£Ÿç±»ä¼¼ï¼Œé‚£ä¹ˆè¯¯å·®é¡¹ç‹¬ç«‹çš„å‡è®¾å°±ä¸èƒ½æˆç«‹ï¼Œæ‰€ä»¥ä¸€ä¸ªè‰¯å¥½çš„å®éªŒè®¾è®¡å¯¹æ¨¡å‹çš„å»ºç«‹æ˜¯éå¸¸é‡è¦çš„

çº¿æ€§å›å½’æ¨¡å‹å¦ä¸€ä¸ªé‡è¦çš„å‡è®¾æ˜¯è¯¯å·®é¡¹æœ‰ç€ä¸å˜çš„æ–¹å·®$Var(\epsilon_i)=\sigma^2$ ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™è¿™ä¸ªå‡è®¾ä¸æˆç«‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Residual plotsçš„æ¨¡å¼æ¥ç®€å•åˆ¤æ–­ï¼Œå¦‚ä¸‹å·¦å›¾ï¼Œå½“responseçš„å€¼å˜å¤§çš„æ—¶å€™æ®‹å·®çš„æ³¢åŠ¨èŒƒå›´ä¹Ÿå˜å¤§(å‘ˆå–‡å­å½¢)ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è®¤ä¸ºæ–¹å·®ä¸é½ï¼Œå³å›¾æ˜¯ç»è¿‡logè½¬åŒ–çš„ï¼š

![image-20200819154941865](https://picgo-wutao.oss-cn-shanghai.aliyuncs.com/img/image-20200819154941865.png)

#### å…±çº¿æ€§

Collinearity(å…±çº¿æ€§)æŒ‡çš„æ˜¯ä¸¤ä¸ªæˆ–è€…å¤šä¸ªå˜é‡é—´ç´§å¯†ç›¸å…³

åˆ¤æ–­å…±çº¿æ€§çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯è®¡ç®—VIF(variance inflation factor)
$$
Y = Î²_0 +Î²_1X_1 +Î²_2X_2 +Â·Â·Â·+Î²_pX_p+Îµ
$$
å¯¹æ¯ä¸ª$X_i$éƒ½å¯ä»¥è®¡ç®—VIF

- å¯¹äº$X_i$,å°†$X_i$è§†ä¸ºå› å˜é‡ï¼Œä¸å…¶ä»–çš„è‡ªå˜é‡è¿›è¡Œæœ€å°äºŒæ¬¡çº¿æ€§å›å½’æ‹Ÿåˆå¯ä»¥è®¡ç®—å‡º$R_i^2$

- è®¡ç®—VIFï¼š
  $$
  VIF=\frac{1}{1-R_i^2}
  $$
  VIFåœ¨5-10ä¹‹é—´è®¤ä¸ºæ˜¯ä¸­åº¦å…±çº¿æ€§ï¼Œå¤§äº10å…±çº¿æ€§å¾ˆä¸¥é‡

å¯¹äºå…±çº¿æ€§å¯ä»¥æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼šä¸¢å¼ƒå…±çº¿æ€§çš„å˜é‡ä¸­çš„ä¸€ä¸ªï¼›æˆ–è€…å°†å…±çº¿æ€§çš„å˜é‡ç»“åˆæˆä¸€ä¸ªå˜é‡